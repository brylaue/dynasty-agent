<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dynasty Agent</title>
  <link rel="stylesheet" href="/static/style.css" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    .hero{max-width:920px;margin:40px auto 10px;text-align:center}
    .hero h1{font-size:36px;margin:0 0 12px}
    .hero p{color:#6b7280;margin:0 0 16px}
    .cta{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
    .btn-lg{padding:12px 18px;border-radius:12px;font-weight:600}
    .stack{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:18px}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">Dynasty Agent</div>
    <div class="spacer"></div>
    <div id="auth-area"></div>
  </header>
  <main class="page">
    <section class="hero">
      <h1>Your fantasy co‑pilot</h1>
      <p>League‑aware research, real‑time news, and smarter trades—tuned to your Sleeper or Yahoo league.</p>
      <div class="cta">
        <button id="google-signin" class="btn btn-primary btn-lg">Sign in with Google</button>
        <button id="signout" class="btn btn-secondary btn-lg" style="display:none;">Sign out</button>
      </div>
      <div class="stack">
        <select id="provider">
          <option value="sleeper">Sleeper</option>
          <option value="yahoo">Yahoo</option>
        </select>
        <input id="landing-league" type="text" placeholder="Sleeper League ID" />
        <button id="yahoo-connect" class="btn btn-secondary" style="display:none;">Connect Yahoo</button>
        <button id="continue" class="btn btn-primary">Continue</button>
      </div>
      <p class="meta">For Sleeper, find your League ID under League → Settings → League ID.</p>
    </section>
  </main>
  <script>
    let SB = null; let SUPABASE_URL = ''; let SUPABASE_ANON = '';
    async function initSupabase() {
      try { const cfg = await (await fetch('/api/public/config')).json(); SUPABASE_URL = cfg.supabase_url||''; SUPABASE_ANON=cfg.supabase_anon||''; if(SUPABASE_URL&&SUPABASE_ANON){ SB = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);} } catch {}
      updateAuthUI();
    }
    async function updateAuthUI(){ const signin=document.getElementById('google-signin'); const signout=document.getElementById('signout'); if(!SB){signin.style.display='inline-block'; signout.style.display='none'; return;} const {data:{session}}=await SB.auth.getSession(); if(session){signin.style.display='none'; signout.style.display='inline-block';} else {signin.style.display='inline-block'; signout.style.display='none';} }
    document.getElementById('google-signin').addEventListener('click', async ()=>{ if(!SB) return alert('Auth not configured'); const {error}=await SB.auth.signInWithOAuth({provider:'google'}); if(error) alert(error.message); });
    document.getElementById('signout').addEventListener('click', async ()=>{ if(SB) await SB.auth.signOut(); updateAuthUI(); });

    const providerSel=document.getElementById('provider'); const leagueInput=document.getElementById('landing-league'); const yahooBtn=document.getElementById('yahoo-connect');
    providerSel.addEventListener('change',()=>{
      const isYahoo=providerSel.value==='yahoo';
      leagueInput.value=''; leagueInput.placeholder=isYahoo?'Yahoo via OAuth—no ID needed':'Sleeper League ID'; leagueInput.disabled=isYahoo; yahooBtn.style.display=isYahoo?'inline-block':'none';
    });
    providerSel.dispatchEvent(new Event('change'));
    yahooBtn.addEventListener('click',()=>{ window.location.href='/api/yahoo/auth'; });

    document.getElementById('continue').addEventListener('click', async ()=>{
      const prov=providerSel.value; const league=leagueInput.value.trim(); localStorage.setItem('provider',prov); if(prov==='sleeper'&&league) localStorage.setItem('league_id',league); else localStorage.removeItem('league_id'); if(SB){ const {data:{session}}=await SB.auth.getSession(); if(session) localStorage.setItem('sb_token', session.access_token);} window.location.href='/app.html';
    });

    initSupabase();
  </script>
</body>
</html>